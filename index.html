
<script src="data.js"></script>
   <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spur AI - Chat Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="data.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .sidebar-transition {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .mobile-menu-slide {
            transform: translateX(100%);
            transition: transform 0.3s ease-out;
        }
        
        .mobile-menu-slide.open {
            transform: translateX(0);
        }
        
        .tooltip {
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
            z-index: 1000;
        }
        
        .tooltip-trigger:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
        
        .chat-item:hover {
            background-color: rgba(59, 130, 246, 0.1);
        }
        
        .nav-item:hover {
            background-color: rgba(59, 130, 246, 0.1);
        }
        
        .sidebar-collapsed .nav-label {
            display: none !important;
        }
        
        .sidebar-collapsed .tooltip {
            display: block;
        }
        
        .sidebar-expanded .tooltip {
            display: none !important;
        }
        
        .sidebar-collapsed .recent-chats-section {
            display: none !important;
        }
        
        .sidebar-collapsed .user-details {
            display: none !important;
        }
        
        .sidebar-collapsed .sidebar-title {
            display: none !important;
        }
        
        .sidebar-collapsed .hamburger-menu {
            display: none !important;
        }
        
        .sidebar-collapsed {
            width: 70px !important;
        }
        
        .sidebar-expanded {
            width: 280px !important;
        }
        
        .modal {
            display: none;
        }
        
        .modal.show {
            display: flex;
        }
        
        .search-results {
            max-height: 300px;
            overflow-y: auto;
        }
        
        @media (max-width: 899px) {
            .desktop-sidebar {
                display: none !important;
            }
            .mobile-header {
                display: flex !important;
            }
            .main-content {
                margin-left: 0 !important;
                padding-top: 70px;
            }
        }
        
        @media (min-width: 900px) {
            .desktop-sidebar {
                display: flex !important;
            }
            .mobile-header {
                display: none !important;
            }
            .main-content {
                padding-top: 0;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Desktop Sidebar -->
    <div id="sidebar" class="desktop-sidebar fixed left-0 top-0 h-full bg-white border-r border-gray-200 sidebar-transition z-40 flex-col shadow-lg sidebar-expanded">
        <!-- Sidebar Header -->
        <div class="p-4 border-b border-gray-100">
            <div class="flex items-center space-x-3 mb-3">
                <div class="w-8 h-8 bg-gradient-to-br from-purple-500 via-blue-500 to-cyan-500 rounded-xl flex items-center justify-center shadow-lg">
                    <i class="fas fa-robot text-white text-lg"></i>
                </div>
                <span class="sidebar-title text-xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">Spur AI</span>
            </div>
            <button id="sidebar-toggle" class="hamburger-menu p-2 rounded-lg hover:bg-gray-100 transition-colors flex items-center space-x-2 text-gray-600 w-full">
                <i class="fas fa-bars"></i>
                <span class="text-sm">Toggle Menu</span>
            </button>
        </div>
        
        <!-- Navigation Items -->
        <div class="flex-1 overflow-y-auto py-4">
            <nav class="space-y-2 px-3">
                <!-- New Chat -->
                <div class="nav-item relative tooltip-trigger">
                    <button id="new-chat-btn" class="w-full flex items-center space-x-3 px-3 py-2.5 rounded-lg text-gray-700 hover:text-blue-600 transition-colors">
                        <i class="fas fa-plus nav-icon text-gray-600"></i>
                        <span class="nav-label font-medium">New Chat</span>
                    </button>
                    <div class="tooltip absolute left-full ml-2 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white px-2 py-1 rounded text-sm whitespace-nowrap">
                        New Chat
                    </div>
                </div>
                
                <!-- Previous Chats -->
                <div class="nav-item relative tooltip-trigger">
                    <button id="previous-chats-btn" class="w-full flex items-center space-x-3 px-3 py-2.5 rounded-lg text-gray-700 hover:text-blue-600 transition-colors">
                        <i class="fas fa-history nav-icon text-gray-600"></i>
                        <span class="nav-label font-medium">Previous Chats</span>
                    </button>
                    <div class="tooltip absolute left-full ml-2 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white px-2 py-1 rounded text-sm whitespace-nowrap">
                        Previous Chats
                    </div>
                </div>
                
                <!-- Search Chat -->
                <div class="nav-item relative tooltip-trigger">
                    <button id="search-chat-btn" class="w-full flex items-center space-x-3 px-3 py-2.5 rounded-lg text-gray-700 hover:text-blue-600 transition-colors">
                        <i class="fas fa-search nav-icon text-gray-600"></i>
                        <span class="nav-label font-medium">Search Chat</span>
                    </button>
                    <div class="tooltip absolute left-full ml-2 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white px-2 py-1 rounded text-sm whitespace-nowrap">
                        Search Chat
                    </div>
                </div>
                
                <!-- Library -->
                <div class="nav-item relative tooltip-trigger">
                    <button id="library-btn" class="w-full flex items-center space-x-3 px-3 py-2.5 rounded-lg text-gray-700 hover:text-blue-600 transition-colors">
                        <i class="fas fa-bookmark nav-icon text-gray-600"></i>
                        <span class="nav-label font-medium">Library</span>
                    </button>
                    <div class="tooltip absolute left-full ml-2 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white px-2 py-1 rounded text-sm whitespace-nowrap">
                        Library
                    </div>
                </div>
                
                <!-- About -->
                <div class="nav-item relative tooltip-trigger">
                    <button id="about-btn" class="w-full flex items-center space-x-3 px-3 py-2.5 rounded-lg text-gray-700 hover:text-blue-600 transition-colors">
                        <i class="fas fa-info-circle nav-icon text-gray-600"></i>
                        <span class="nav-label font-medium">About</span>
                    </button>
                    <div class="tooltip absolute left-full ml-2 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white px-2 py-1 rounded text-sm whitespace-nowrap">
                        About
                    </div>
                </div>
                
                <!-- Settings -->
                <div class="nav-item relative tooltip-trigger">
                    <button id="settings-btn" class="w-full flex items-center space-x-3 px-3 py-2.5 rounded-lg text-gray-700 hover:text-blue-600 transition-colors">
                        <i class="fas fa-cog nav-icon text-gray-600"></i>
                        <span class="nav-label font-medium">Settings</span>
                    </button>
                    <div class="tooltip absolute left-full ml-2 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white px-2 py-1 rounded text-sm whitespace-nowrap">
                        Settings
                    </div>
                </div>
            </nav>
            
            <!-- Recent Chats Section -->
            <div class="recent-chats-section mt-6 px-3">
                <div class="border-t border-gray-100 pt-4">
                    <h3 class="text-sm font-semibold text-gray-500 mb-3">Recent Chats</h3>
                    <div class="space-y-1" id="recent-chats-list">
                        <!-- Recent chats will be populated here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- User Info Footer -->
        <div class="border-t border-gray-100 p-4">
            <div class="flex items-center space-x-3 relative tooltip-trigger" id="user-info-section">
                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-user text-blue-600"></i>
                </div>
                <div class="user-details flex-1 min-w-0">
                    <div class="text-sm font-medium text-gray-800 truncate" id="user-name">Guest User</div>
                    <div class="text-xs text-gray-500 truncate" id="user-email">Not signed in</div>
                </div>
                <button id="auth-btn" class="text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700 transition-colors">
                    Sign Up
                </button>
                <div class="tooltip absolute left-full ml-2 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white px-2 py-1 rounded text-sm whitespace-nowrap">
                    User Profile
                </div>
            </div>
        </div>
    </div>
    
    <!-- Mobile Header -->
    <div class="mobile-header fixed top-0 left-0 right-0 bg-white border-b border-gray-200 px-4 py-3 shadow-sm z-50" style="display: none;">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <div class="w-8 h-8 bg-gradient-to-br from-purple-500 via-blue-500 to-cyan-500 rounded-xl flex items-center justify-center shadow-lg">
                    <i class="fas fa-robot text-white"></i>
                </div>
                <span class="text-lg font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">Spur AI</span>
            </div>
            
            <button id="mobile-menu-toggle" class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                <i class="fas fa-bars text-gray-600"></i>
            </button>
        </div>
    </div>
    
    <!-- Mobile Menu Dropdown (Right Side) -->
    <div id="mobile-menu" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="bg-white w-full max-w-sm ml-auto h-full shadow-xl mobile-menu-slide">
            <div class="p-4 border-b border-gray-100">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 bg-gradient-to-br from-purple-500 via-blue-500 to-cyan-500 rounded-xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-robot text-white"></i>
                        </div>
                        <span class="text-lg font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">Spur AI</span>
                    </div>
                    <button id="mobile-menu-close" class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i class="fas fa-times text-gray-600"></i>
                    </button>
                </div>
            </div>
            
            <nav class="py-4">
                <div class="space-y-1 px-4">
                    <button id="mobile-new-chat-btn" class="w-full flex items-center space-x-3 px-3 py-3 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                        <i class="fas fa-plus text-gray-600"></i>
                        <span class="font-medium">New Chat</span>
                    </button>
                    <button id="mobile-previous-chats-btn" class="w-full flex items-center space-x-3 px-3 py-3 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                        <i class="fas fa-history text-gray-600"></i>
                        <span class="font-medium">Previous Chats</span>
                    </button>
                    <button id="mobile-search-chat-btn" class="w-full flex items-center space-x-3 px-3 py-3 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                        <i class="fas fa-search text-gray-600"></i>
                        <span class="font-medium">Search Chat</span>
                    </button>
                    <button id="mobile-library-btn" class="w-full flex items-center space-x-3 px-3 py-3 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                        <i class="fas fa-bookmark text-gray-600"></i>
                        <span class="font-medium">Library</span>
                    </button>
                    <button id="mobile-about-btn" class="w-full flex items-center space-x-3 px-3 py-3 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                        <i class="fas fa-info-circle text-gray-600"></i>
                        <span class="font-medium">About</span>
                    </button>
                    <button id="mobile-settings-btn" class="w-full flex items-center space-x-3 px-3 py-3 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                        <i class="fas fa-cog text-gray-600"></i>
                        <span class="font-medium">Settings</span>
                    </button>
                </div>
                
                <div class="border-t border-gray-100 mt-6 pt-6 px-4">
                    <div class="flex items-center space-x-3 px-3 py-2">
                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-blue-600"></i>
                        </div>
                        <div class="flex-1">
                            <div class="text-sm font-medium text-gray-800" id="mobile-user-name">Guest User</div>
                            <div class="text-xs text-gray-500" id="mobile-user-email">Not signed in</div>
                        </div>
                        <button id="mobile-auth-btn" class="text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700 transition-colors">
                            Sign Up
                        </button>
                    </div>
                </div>
            </nav>
        </div>
    </div>
    
    <!-- Main Content Area -->
    <div id="main-content" class="main-content sidebar-transition" style="margin-left: 280px;">
        <!-- Chat Interface -->
        <div class="flex flex-col h-screen" id="chat-interface">
            <!-- Chat Messages Area -->
            <div class="flex-1 overflow-y-auto p-4" id="chat-messages">
                <div class="max-w-4xl mx-auto space-y-4">
                    <!-- Welcome Message -->
                    <div class="text-center py-8">
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 via-blue-500 to-cyan-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                            <i class="fas fa-robot text-white text-3xl"></i>
                        </div>
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">Welcome to Spur AI</h1>
                        <p class="text-gray-600 mb-4">Your intelligent assistant is ready to help!</p>
                    </div>
                    
                    <!-- Sample Messages -->
                    <div class="flex justify-start">
                        <div class="bg-gray-100 rounded-lg p-3 max-w-xs">
                            <p class="text-gray-800">Hello! I'm Spur AI. I've been trained on various topics and I'm ready to help you. What would you like to know?</p>
                            <span class="text-xs text-gray-500 mt-1 block">Just now</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Message Input Area -->
            <div class="border-t border-gray-200 p-4 bg-white">
                <div class="max-w-4xl mx-auto">
                    <div class="flex items-center space-x-3">
                        <div class="flex-1 relative">
                            <input 
                                type="text" 
                                id="message-input" 
                                placeholder="Type your message here..." 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            >
                        </div>
                        <button 
                            id="send-btn" 
                            class="bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg transition-colors flex items-center justify-center"
                        >
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Previous Chats View -->
        <div id="previous-chats-view" class="hidden p-8">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Previous Chats</h2>
                    <div id="previous-chats-content" class="space-y-3">
                        <!-- Previous chats will be populated here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Search View -->
        <div id="search-view" class="hidden p-8">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Search Chats</h2>
                    <div class="mb-6">
                        <input 
                            type="text" 
                            id="search-input" 
                            placeholder="Search your conversations..." 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        >
                    </div>
                    <div id="search-results" class="search-results space-y-3">
                        <p class="text-gray-500 text-center py-8">Enter a search term to find your conversations</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Library View -->
        <div id="library-view" class="hidden p-8">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Knowledge Library</h2>
                    <div id="library-content" class="space-y-4">
                        <!-- Library content will be populated here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Settings View -->
        <div id="settings-view" class="hidden p-8">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Settings</h2>
                    <div class="text-center py-12">
                        <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-cog text-gray-400 text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-600 mb-2">Settings Coming Soon</h3>
                        <p class="text-gray-500">Advanced settings and customization options will be available here!</p>
                        <div class="mt-6">
                            <button id="clear-data-btn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors">
                                Clear All Chat Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- About Modal -->
    <div id="about-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center">
        <div class="bg-white rounded-xl p-6 max-w-md mx-4 shadow-2xl">
            <div class="text-center">
                <div class="w-16 h-16 bg-gradient-to-br from-purple-500 via-blue-500 to-cyan-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                    <i class="fas fa-robot text-white text-3xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 mb-3">About Spur AI</h2>
                <p class="text-gray-600 mb-4">Spur AI is an advanced conversational AI assistant designed to help you with various tasks, answer questions, and provide intelligent insights based on trained data.</p>
                
                <div class="space-y-2 mb-6">
                    <p class="text-sm text-gray-500">Learn more about our AI technology:</p>
                    <div class="flex flex-col space-y-2">
                        <a href="https://about.babblsoft.com" target="_blank" class="text-blue-600 hover:text-blue-700 text-sm font-medium">
                            <i class="fas fa-external-link-alt mr-1"></i>about.babblsoft.com
                        </a>
                        <a href="https://aistudio.babblsoft.com" target="_blank" class="text-blue-600 hover:text-blue-700 text-sm font-medium">
                            <i class="fas fa-external-link-alt mr-1"></i>aistudio.babblsoft.com
                        </a>
                        <a href="https://spur.babbl.com" target="_blank" class="text-blue-600 hover:text-blue-700 text-sm font-medium">
                            <i class="fas fa-external-link-alt mr-1"></i>spur.babbl.com
                        </a>
                    </div>
                </div>
                
                <button id="close-about" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg transition-colors">
                    Close
                </button>
            </div>
        </div>
    </div>
    
    <!-- Signup Modal -->
    <div id="signup-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center">
        <div class="bg-white rounded-xl p-6 max-w-md mx-4 shadow-2xl">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-gradient-to-br from-purple-500 via-blue-500 to-cyan-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                    <i class="fas fa-user-plus text-white text-3xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">Join Spur AI</h2>
                <p class="text-gray-600">Create your account to get started</p>
            </div>
            
            <form id="signup-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                    <input type="text" id="signup-name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                    <input type="email" id="signup-email" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex space-x-3 pt-4">
                    <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg transition-colors">
                        Sign Up
                    </button>
                    <button type="button" id="close-signup" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-2 rounded-lg transition-colors">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- AI Training Data -->
    <script>
        // AI Training Data - You can modify this to train the AI
        window.aiTrainingData = [
            {
                question: "What is Spur AI?",
                answer: "Spur AI is an advanced conversational AI assistant created by Babbl Soft. I'm designed to help you with various tasks, answer questions, and provide intelligent insights. I can understand natural language and provide helpful responses based on my training data."
            },
            {
                question: "What can Spur AI do?",
                answer: "I can help you with many things! I can answer questions, have conversations, help with problem-solving, provide information on topics I've been trained on, assist with writing tasks, and much more. Just ask me anything and I'll do my best to help!"
            },
            {
                question: "Who created Spur AI?",
                answer: "I was created by Babbl Soft, a technology company focused on AI solutions. You can learn more about them at babblsoft.com and their AI studio at aistudio.babblsoft.com."
            },
            {
                question: "How does Spur AI work?",
                answer: "I work by analyzing your messages and finding the best responses from my training data. I use advanced matching algorithms that look at keywords, context, and meaning to understand what you're asking and provide relevant answers."
            },
            {
                question: "Can Spur AI learn?",
                answer: "Yes! I can learn from our conversations. Each chat we have helps me understand better ways to respond. My training data can also be updated to include new information and improve my responses over time."
            },
            {
                question: "What is artificial intelligence?",
                answer: "Artificial Intelligence (AI) is technology that enables machines to simulate human intelligence. It includes capabilities like learning, reasoning, problem-solving, and understanding language. AI systems like me can process information and respond in ways that seem intelligent and helpful."
            },
            {
                question: "How do I use Spur AI?",
                answer: "Using me is simple! Just type your question or message in the chat box and press send. I'll analyze what you're asking and provide the best response I can. You can ask me about anything - from general questions to specific topics I've been trained on."
            },
            {
                question: "Is Spur AI free to use?",
                answer: "Yes, I'm currently free to use! You can chat with me, save conversations, and access all my features without any cost. Just start typing and we can begin our conversation right away."
            },
            {
                question: "Can I save my conversations with Spur AI?",
                answer: "Absolutely! All your conversations with me are automatically saved in your browser. You can access them anytime through the 'Previous Chats' section in the sidebar. You can also search through your chat history to find specific conversations."
            },
            {
                question: "What topics can Spur AI help with?",
                answer: "I can help with a wide variety of topics! This includes general knowledge questions, technology, AI concepts, problem-solving, writing assistance, and much more. My knowledge comes from my training data, so feel free to ask about anything and I'll let you know if I can help!"
            }
        ];
    </script>
    
    <script>
        // AI System with Learning Capabilities
        class SpurAI {
            constructor() {
                // Load training data from external file or fallback to embedded data
                this.trainingData = window.aiTrainingData || this.getDefaultTrainingData();
                this.conversations = JSON.parse(localStorage.getItem('conversations')) || [];
                this.currentChatId = null;
                
                // Debug: Log training data to verify it's loaded
                console.log('Training data loaded:', this.trainingData.length, 'entries');
            }
            
            // Fallback training data if external file not loaded
            getDefaultTrainingData() {
                return [
                    {
                        question: "What is Spur AI?",
                        answer: "Spur AI is an advanced conversational AI assistant created by Babbl Soft. I'm designed to help you with various tasks, answer questions, and provide intelligent insights."
                    },
                    {
                        question: "hello",
                        answer: "Hello! I'm Spur AI, your intelligent assistant. How can I help you today?"
                    },
                    {
                        question: "hi",
                        answer: "Hi there! I'm here to help you with any questions or tasks you have. What would you like to know?"
                    },
                    {
                        question: "test",
                        answer: "I'm working perfectly! This is a test response to confirm I can understand and respond to your messages."
                    }
                ];
            }
            
            // Find best response based on training data
            findBestResponse(userMessage) {
                const message = userMessage.toLowerCase().trim();
                let bestMatch = null;
                let highestScore = 0;
                
                // First try exact matches and very close matches
                for (const data of this.trainingData) {
                    const question = data.question ? data.question.toLowerCase().trim() : '';
                    
                    // Check for exact match first
                    if (message === question) {
                        return data.answer;
                    }
                    
                    // Check if user message contains the question or vice versa
                    if (message.includes(question) || question.includes(message)) {
                        if (question.length > 3) { // Avoid matching very short strings
                            return data.answer;
                        }
                    }
                    
                    // Calculate multiple types of similarity
                    const exactScore = this.calculateSimilarity(message, question);
                    const keywordScore = this.calculateKeywordMatch(message, question);
                    const semanticScore = this.calculateSemanticMatch(message, question);
                    const containsScore = this.calculateContainsMatch(message, question);
                    
                    // Weighted combination of scores (lowered threshold)
                    const finalScore = (exactScore * 0.3) + (keywordScore * 0.3) + (semanticScore * 0.2) + (containsScore * 0.2);
                    
                    if (finalScore > highestScore && finalScore > 0.15) { // Lowered threshold
                        highestScore = finalScore;
                        bestMatch = data;
                    }
                }
                
                if (bestMatch) {
                    return bestMatch.answer || "I found information about that topic.";
                }
                
                return this.getDefaultResponse();
            }
            
            // Calculate similarity between two strings
            calculateSimilarity(str1, str2) {
                const words1 = str1.split(' ').filter(word => word.length > 2);
                const words2 = str2.split(' ').filter(word => word.length > 2);
                let matches = 0;
                
                for (const word1 of words1) {
                    for (const word2 of words2) {
                        if (word1.includes(word2) || word2.includes(word1) || 
                            this.levenshteinDistance(word1, word2) <= 2) {
                            matches++;
                        }
                    }
                }
                
                return matches / Math.max(words1.length, words2.length);
            }
            
            // Calculate keyword-based matching
            calculateKeywordMatch(userMessage, questionText) {
                const userWords = this.extractKeywords(userMessage);
                const questionWords = this.extractKeywords(questionText);
                
                let matches = 0;
                let totalKeywords = Math.max(userWords.length, questionWords.length);
                
                for (const userWord of userWords) {
                    for (const questionWord of questionWords) {
                        // Exact match
                        if (userWord === questionWord) {
                            matches += 1;
                        }
                        // Partial match (one contains the other)
                        else if (userWord.includes(questionWord) || questionWord.includes(userWord)) {
                            matches += 0.8;
                        }
                        // Similar words (small edit distance)
                        else if (this.levenshteinDistance(userWord, questionWord) <= 1 && userWord.length > 3) {
                            matches += 0.6;
                        }
                    }
                }
                
                return totalKeywords > 0 ? matches / totalKeywords : 0;
            }
            
            // Calculate semantic matching using common patterns
            calculateSemanticMatch(userMessage, questionText) {
                // Common question patterns and their variations
                const patterns = [
                    { base: ['what', 'is'], variations: ['whats', 'what\'s', 'define', 'explain', 'tell me about'] },
                    { base: ['how', 'to'], variations: ['how do i', 'how can i', 'steps to', 'way to'] },
                    { base: ['why'], variations: ['why do', 'why does', 'reason for', 'because'] },
                    { base: ['where'], variations: ['where is', 'where can', 'location of'] },
                    { base: ['when'], variations: ['when do', 'when does', 'time for'] },
                    { base: ['who'], variations: ['who is', 'who are', 'person'] }
                ];
                
                let semanticScore = 0;
                
                for (const pattern of patterns) {
                    const userHasPattern = this.hasPattern(userMessage, [...pattern.base, ...pattern.variations]);
                    const questionHasPattern = this.hasPattern(questionText, [...pattern.base, ...pattern.variations]);
                    
                    if (userHasPattern && questionHasPattern) {
                        semanticScore += 0.5;
                    }
                }
                
                return Math.min(semanticScore, 1.0);
            }
            
            // Calculate contains matching - checks if key phrases are contained
            calculateContainsMatch(userMessage, questionText) {
                const userWords = userMessage.split(' ').filter(word => word.length > 2);
                const questionWords = questionText.split(' ').filter(word => word.length > 2);
                
                let containsScore = 0;
                let totalWords = Math.max(userWords.length, questionWords.length);
                
                for (const userWord of userWords) {
                    for (const questionWord of questionWords) {
                        if (userWord.includes(questionWord) || questionWord.includes(userWord)) {
                            containsScore += 1;
                        }
                    }
                }
                
                return totalWords > 0 ? Math.min(containsScore / totalWords, 1.0) : 0;
            }
            
            // Extract meaningful keywords from text
            extractKeywords(text) {
                const stopWords = ['the', 'is', 'at', 'which', 'on', 'and', 'a', 'to', 'are', 'as', 'was', 'with', 'for', 'be', 'have', 'has', 'had', 'do', 'does', 'did', 'will', 'would', 'could', 'should', 'may', 'might', 'can', 'of', 'in', 'by', 'from', 'up', 'about', 'into', 'through', 'during', 'before', 'after', 'above', 'below', 'between', 'among', 'an', 'but', 'or', 'so', 'than', 'too', 'very', 'just', 'now', 'then', 'there', 'here', 'when', 'where', 'why', 'how', 'all', 'any', 'both', 'each', 'few', 'more', 'most', 'other', 'some', 'such', 'no', 'nor', 'not', 'only', 'own', 'same', 'so', 'than', 'too', 'very', 'can', 'will', 'just', 'don', 'should', 'now'];
                
                return text.toLowerCase()
                    .replace(/[^\w\s]/g, ' ')
                    .split(/\s+/)
                    .filter(word => word.length > 2 && !stopWords.includes(word))
                    .filter(word => word.trim() !== '');
            }
            
            // Check if text contains any of the given patterns
            hasPattern(text, patterns) {
                const lowerText = text.toLowerCase();
                return patterns.some(pattern => {
                    if (typeof pattern === 'string') {
                        return lowerText.includes(pattern);
                    }
                    return false;
                });
            }
            
            // Calculate edit distance between words
            levenshteinDistance(str1, str2) {
                const matrix = [];
                
                for (let i = 0; i <= str2.length; i++) {
                    matrix[i] = [i];
                }
                
                for (let j = 0; j <= str1.length; j++) {
                    matrix[0][j] = j;
                }
                
                for (let i = 1; i <= str2.length; i++) {
                    for (let j = 1; j <= str1.length; j++) {
                        if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                            matrix[i][j] = matrix[i - 1][j - 1];
                        } else {
                            matrix[i][j] = Math.min(
                                matrix[i - 1][j - 1] + 1,
                                matrix[i][j - 1] + 1,
                                matrix[i - 1][j] + 1
                            );
                        }
                    }
                }
                
                return matrix[str2.length][str1.length];
            }
            
            // Get default response when no match found
            getDefaultResponse() {
                const defaultResponses = [
                    "That's an interesting question! Could you provide more details so I can help you better?",
                    "I'd be happy to help! Can you tell me more about what you're looking for?",
                    "I understand you're asking about something specific. Could you rephrase that or give me more context?",
                    "I'm here to assist you! Let me know if you can provide more information about your question."
                ];
                return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
            }
            
            // Method to reload training data (useful for testing)
            reloadTrainingData() {
                this.trainingData = window.aiTrainingData || this.getDefaultTrainingData();
                console.log('Training data reloaded:', this.trainingData.length, 'entries');
                return this.trainingData.length;
            }
            
            // Extract meaningful title from conversation
            generateChatTitle(userMessage, aiResponse) {
                const combinedText = (userMessage + ' ' + aiResponse).toLowerCase();
                
                // Common nouns and topics that make good titles
                const titleKeywords = [
                    // Technology
                    'artificial intelligence', 'ai', 'machine learning', 'programming', 'coding', 'software', 'computer', 'technology', 'internet', 'website', 'app', 'database', 'algorithm', 'python', 'javascript', 'html', 'css',
                    
                    // Science
                    'science', 'physics', 'chemistry', 'biology', 'mathematics', 'research', 'experiment', 'theory', 'hypothesis', 'data', 'analysis',
                    
                    // Business
                    'business', 'marketing', 'finance', 'investment', 'startup', 'company', 'management', 'strategy', 'sales', 'customer', 'product', 'service',
                    
                    // Education
                    'education', 'learning', 'school', 'university', 'student', 'teacher', 'course', 'study', 'homework', 'exam', 'degree',
                    
                    // Health
                    'health', 'medicine', 'doctor', 'hospital', 'treatment', 'disease', 'fitness', 'exercise', 'nutrition', 'diet',
                    
                    // General topics
                    'recipe', 'cooking', 'food', 'travel', 'music', 'movie', 'book', 'art', 'history', 'culture', 'language', 'writing', 'creative', 'design', 'photography',
                    
                    // Common question words that indicate topics
                    'how to', 'what is', 'why does', 'when to', 'where is'
                ];
                
                // Find the best keyword match
                let bestTitle = '';
                let longestMatch = 0;
                
                for (const keyword of titleKeywords) {
                    if (combinedText.includes(keyword) && keyword.length > longestMatch) {
                        longestMatch = keyword.length;
                        bestTitle = keyword;
                    }
                }
                
                // If we found a good keyword, capitalize it properly
                if (bestTitle) {
                    return bestTitle.split(' ')
                        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                        .join(' ');
                }
                
                // Fallback: extract important nouns from the user message
                const words = userMessage.toLowerCase().split(/\s+/);
                const stopWords = ['the', 'is', 'at', 'which', 'on', 'and', 'a', 'to', 'are', 'as', 'was', 'with', 'for', 'be', 'have', 'has', 'had', 'do', 'does', 'did', 'will', 'would', 'could', 'should', 'may', 'might', 'can', 'of', 'in', 'by', 'from', 'up', 'about', 'into', 'through', 'during', 'before', 'after', 'above', 'below', 'between', 'among', 'an', 'but', 'or', 'so', 'than', 'too', 'very', 'just', 'now', 'then', 'there', 'here', 'when', 'where', 'why', 'how', 'all', 'any', 'both', 'each', 'few', 'more', 'most', 'other', 'some', 'such', 'no', 'nor', 'not', 'only', 'own', 'same'];
                
                const meaningfulWords = words.filter(word => 
                    word.length > 3 && 
                    !stopWords.includes(word) && 
                    /^[a-zA-Z]+$/.test(word)
                );
                
                if (meaningfulWords.length > 0) {
                    const firstWord = meaningfulWords[0];
                    return firstWord.charAt(0).toUpperCase() + firstWord.slice(1);
                }
                
                // Final fallback
                return userMessage.substring(0, 30) + (userMessage.length > 30 ? '...' : '');
            }
            
            // Save conversation
            saveConversation(userMessage, aiResponse) {
                if (!this.currentChatId) {
                    this.currentChatId = Date.now().toString();
                    const chatTitle = this.generateChatTitle(userMessage, aiResponse);
                    this.conversations.push({
                        id: this.currentChatId,
                        title: chatTitle,
                        messages: [],
                        timestamp: new Date().toISOString()
                    });
                }
                
                const currentChat = this.conversations.find(chat => chat.id === this.currentChatId);
                if (currentChat) {
                    currentChat.messages.push(
                        { type: 'user', content: userMessage, timestamp: new Date().toISOString() },
                        { type: 'ai', content: aiResponse, timestamp: new Date().toISOString() }
                    );
                }
                
                localStorage.setItem('conversations', JSON.stringify(this.conversations));
                this.updateRecentChats();
            }
            
            // Update recent chats display
            updateRecentChats() {
                const recentChatsContainer = document.getElementById('recent-chats-list');
                const recentChats = this.conversations.slice(-5).reverse();
                
                recentChatsContainer.innerHTML = '';
                
                recentChats.forEach(chat => {
                    const chatItem = document.createElement('div');
                    chatItem.className = 'chat-item flex items-center space-x-2 px-2 py-1.5 rounded text-sm text-gray-600 cursor-pointer transition-colors';
                    chatItem.innerHTML = `
                        <i class="fas fa-comment-dots text-xs text-gray-400"></i>
                        <span class="truncate">${chat.title}</span>
                    `;
                    chatItem.addEventListener('click', () => this.loadChat(chat.id));
                    recentChatsContainer.appendChild(chatItem);
                });
                
                if (recentChats.length > 0) {
                    const seeMoreBtn = document.createElement('button');
                    seeMoreBtn.className = 'text-xs text-blue-600 hover:text-blue-700 mt-2 font-medium';
                    seeMoreBtn.textContent = 'See more →';
                    seeMoreBtn.addEventListener('click', () => showView('previous-chats-view'));
                    recentChatsContainer.appendChild(seeMoreBtn);
                }
            }
            
            // Load specific chat
            loadChat(chatId) {
                const chat = this.conversations.find(c => c.id === chatId);
                if (!chat) return;
                
                this.currentChatId = chatId;
                const chatMessages = document.getElementById('chat-messages');
                chatMessages.innerHTML = '';
                
                chat.messages.forEach(message => {
                    addMessage(message.content, message.type);
                });
                
                showView('chat-interface');
            }
            
            // Start new chat
            newChat() {
                this.currentChatId = null;
                const chatMessages = document.getElementById('chat-messages');
                chatMessages.innerHTML = `
                    <div class="max-w-4xl mx-auto space-y-4">
                        <div class="text-center py-8">
                            <div class="w-16 h-16 bg-gradient-to-br from-purple-500 via-blue-500 to-cyan-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                                <i class="fas fa-robot text-white text-3xl"></i>
                            </div>
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">New Chat Started</h1>
                            <p class="text-gray-600 mb-4">What would you like to discuss?</p>
                        </div>
                        <div class="flex justify-start">
                            <div class="bg-gray-100 rounded-lg p-3 max-w-xs">
                                <p class="text-gray-800">Hello! I'm ready for a new conversation. What can I help you with today?</p>
                                <span class="text-xs text-gray-500 mt-1 block">Just now</span>
                            </div>
                        </div>
                    </div>
                `;
                showView('chat-interface');
            }
            
            // Search conversations
            searchConversations(query) {
                if (!query.trim()) return [];
                
                const results = [];
                const searchTerm = query.toLowerCase();
                
                this.conversations.forEach(chat => {
                    chat.messages.forEach(message => {
                        if (message.content.toLowerCase().includes(searchTerm)) {
                            results.push({
                                chatId: chat.id,
                                chatTitle: chat.title,
                                message: message.content,
                                type: message.type,
                                timestamp: message.timestamp
                            });
                        }
                    });
                });
                
                return results.slice(0, 20); // Limit results
            }
        }
        
        // Initialize AI system
        const ai = new SpurAI();
        
        // State management
        let sidebarOpen = localStorage.getItem('sidebarOpen') !== 'false';
        let mobileMenuOpen = false;
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let currentView = 'chat-interface';
        
        // DOM elements
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const mainContent = document.getElementById('main-content');
        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        const mobileMenu = document.getElementById('mobile-menu');
        const mobileMenuClose = document.getElementById('mobile-menu-close');
        const messageInput = document.getElementById('message-input');
        const sendBtn = document.getElementById('send-btn');
        const chatMessages = document.getElementById('chat-messages');
        
        // Initialize app
        function initializeApp() {
            updateUserInfo();
            ai.updateRecentChats();
            populateLibrary();
            if (window.innerWidth >= 900) {
                updateSidebarState();
            }
            setupEventListeners();
        }
        
        // Show specific view
        function showView(viewId) {
            const views = ['chat-interface', 'previous-chats-view', 'search-view', 'library-view', 'settings-view'];
            views.forEach(view => {
                const element = document.getElementById(view);
                if (element) {
                    element.classList.add('hidden');
                }
            });
            const targetView = document.getElementById(viewId);
            if (targetView) {
                targetView.classList.remove('hidden');
                currentView = viewId;
            }
        }
        
        // Update user info display
        function updateUserInfo() {
            const userName = document.getElementById('user-name');
            const userEmail = document.getElementById('user-email');
            const mobileUserName = document.getElementById('mobile-user-name');
            const mobileUserEmail = document.getElementById('mobile-user-email');
            const authBtn = document.getElementById('auth-btn');
            const mobileAuthBtn = document.getElementById('mobile-auth-btn');
            
            if (currentUser) {
                userName.textContent = currentUser.name;
                userEmail.textContent = currentUser.email;
                mobileUserName.textContent = currentUser.name;
                mobileUserEmail.textContent = currentUser.email;
                authBtn.textContent = 'Sign Out';
                mobileAuthBtn.textContent = 'Sign Out';
            } else {
                userName.textContent = 'Guest User';
                userEmail.textContent = 'Not signed in';
                mobileUserName.textContent = 'Guest User';
                mobileUserEmail.textContent = 'Not signed in';
                authBtn.textContent = 'Sign Up';
                mobileAuthBtn.textContent = 'Sign Up';
            }
        }
        
        // Update sidebar state
        function updateSidebarState() {
            if (window.innerWidth < 900) {
                // Mobile - don't apply sidebar states
                return;
            }
            
            if (sidebarOpen) {
                sidebar.classList.remove('sidebar-collapsed');
                sidebar.classList.add('sidebar-expanded');
                sidebar.style.width = '280px';
                mainContent.style.marginLeft = '280px';
            } else {
                sidebar.classList.remove('sidebar-expanded');
                sidebar.classList.add('sidebar-collapsed');
                sidebar.style.width = '70px';
                mainContent.style.marginLeft = '70px';
            }
            localStorage.setItem('sidebarOpen', sidebarOpen);
        }
        
        // Toggle sidebar
        function toggleSidebar() {
            sidebarOpen = !sidebarOpen;
            updateSidebarState();
        }
        
        // Toggle mobile menu
        function toggleMobileMenu() {
            mobileMenuOpen = !mobileMenuOpen;
            const menuSlide = mobileMenu.querySelector('.mobile-menu-slide');
            
            if (mobileMenuOpen) {
                mobileMenu.classList.remove('hidden');
                setTimeout(() => menuSlide.classList.add('open'), 10);
                document.body.style.overflow = 'hidden';
            } else {
                menuSlide.classList.remove('open');
                setTimeout(() => mobileMenu.classList.add('hidden'), 300);
                document.body.style.overflow = 'auto';
            }
        }
        
        // Send message
        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;
            
            // Add user message
            addMessage(message, 'user');
            messageInput.value = '';
            
            // Get AI response
            setTimeout(() => {
                const aiResponse = ai.findBestResponse(message);
                addMessage(aiResponse, 'ai');
                ai.saveConversation(message, aiResponse);
            }, 500);
        }
        
        // Add message to chat
        function addMessage(text, sender) {
            const messagesContainer = chatMessages.querySelector('.mx-auto') || chatMessages;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
            
            const messageContent = document.createElement('div');
            messageContent.className = `${sender === 'user' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-800'} rounded-lg p-3 max-w-xs lg:max-w-md`;
            
            const messageText = document.createElement('p');
            messageText.textContent = text;
            
            const timestamp = document.createElement('span');
            timestamp.className = `text-xs ${sender === 'user' ? 'text-blue-100' : 'text-gray-500'} mt-1 block`;
            timestamp.textContent = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            messageContent.appendChild(messageText);
            messageContent.appendChild(timestamp);
            messageDiv.appendChild(messageContent);
            
            messagesContainer.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Populate previous chats
        function populatePreviousChats() {
            const container = document.getElementById('previous-chats-content');
            container.innerHTML = '';
            
            if (ai.conversations.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No previous conversations found</p>';
                return;
            }
            
            ai.conversations.slice().reverse().forEach(chat => {
                const chatDiv = document.createElement('div');
                chatDiv.className = 'border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors';
                chatDiv.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="font-medium text-gray-800">${chat.title}</h3>
                        <span class="text-xs text-gray-500">${new Date(chat.timestamp).toLocaleDateString()}</span>
                    </div>
                    <p class="text-sm text-gray-600">${chat.messages.length} messages</p>
                `;
                chatDiv.addEventListener('click', () => ai.loadChat(chat.id));
                container.appendChild(chatDiv);
            });
        }
        
        // Search state
        let searchResults = [];
        let currentSearchIndex = 0;
        
        // Handle search with highlighting
        function handleSearch() {
            const query = document.getElementById('search-input').value;
            const resultsContainer = document.getElementById('search-results');
            
            if (!query.trim()) {
                resultsContainer.innerHTML = '<p class="text-gray-500 text-center py-8">Enter a search term to find your conversations</p>';
                searchResults = [];
                currentSearchIndex = 0;
                return;
            }
            
            searchResults = ai.searchConversations(query);
            currentSearchIndex = 0;
            
            if (searchResults.length === 0) {
                resultsContainer.innerHTML = '<p class="text-gray-500 text-center py-8">No results found</p>';
                return;
            }
            
            displaySearchResults(query);
        }
        
        // Display search results with highlighting
        function displaySearchResults(query) {
            const resultsContainer = document.getElementById('search-results');
            resultsContainer.innerHTML = '';
            
            // Search navigation
            if (searchResults.length > 1) {
                const navDiv = document.createElement('div');
                navDiv.className = 'flex items-center justify-between mb-4 p-3 bg-blue-50 rounded-lg';
                navDiv.innerHTML = `
                    <span class="text-sm text-blue-800">Found ${searchResults.length} results</span>
                    <div class="flex items-center space-x-2">
                        <button id="prev-result" class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors" ${currentSearchIndex === 0 ? 'disabled' : ''}>
                            Previous
                        </button>
                        <span class="text-sm text-blue-800">${currentSearchIndex + 1} of ${searchResults.length}</span>
                        <button id="next-result" class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors" ${currentSearchIndex === searchResults.length - 1 ? 'disabled' : ''}>
                            Next
                        </button>
                    </div>
                `;
                resultsContainer.appendChild(navDiv);
                
                // Add navigation event listeners
                const prevBtn = document.getElementById('prev-result');
                const nextBtn = document.getElementById('next-result');
                
                prevBtn.addEventListener('click', () => {
                    if (currentSearchIndex > 0) {
                        currentSearchIndex--;
                        displaySearchResults(query);
                    }
                });
                
                nextBtn.addEventListener('click', () => {
                    if (currentSearchIndex < searchResults.length - 1) {
                        currentSearchIndex++;
                        displaySearchResults(query);
                    }
                });
            }
            
            // Display current result
            const result = searchResults[currentSearchIndex];
            const resultDiv = document.createElement('div');
            resultDiv.className = 'border-2 border-blue-300 bg-blue-50 rounded-lg p-4 cursor-pointer transition-colors';
            
            // Highlight the search term
            const highlightedMessage = highlightText(result.message, query);
            
            resultDiv.innerHTML = `
                <div class="flex items-center justify-between mb-2">
                    <h3 class="font-medium text-gray-800">${result.chatTitle}</h3>
                    <span class="text-xs text-gray-500">${new Date(result.timestamp).toLocaleDateString()}</span>
                </div>
                <p class="text-sm text-gray-700 mb-2"><strong class="text-blue-800">${result.type === 'user' ? 'You' : 'AI'}:</strong></p>
                <div class="text-sm text-gray-800 bg-white p-3 rounded border">${highlightedMessage}</div>
                <button class="mt-3 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors text-sm">
                    Open Chat
                </button>
            `;
            
            resultDiv.addEventListener('click', () => ai.loadChat(result.chatId));
            resultsContainer.appendChild(resultDiv);
            
            // Show other results (dimmed)
            searchResults.forEach((otherResult, index) => {
                if (index !== currentSearchIndex) {
                    const otherDiv = document.createElement('div');
                    otherDiv.className = 'border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors opacity-60 mt-3';
                    otherDiv.innerHTML = `
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-medium text-gray-600">${otherResult.chatTitle}</h3>
                            <span class="text-xs text-gray-400">${new Date(otherResult.timestamp).toLocaleDateString()}</span>
                        </div>
                        <p class="text-sm text-gray-500"><strong>${otherResult.type === 'user' ? 'You' : 'AI'}:</strong> ${otherResult.message.substring(0, 80)}...</p>
                    `;
                    otherDiv.addEventListener('click', () => {
                        currentSearchIndex = index;
                        displaySearchResults(query);
                    });
                    resultsContainer.appendChild(otherDiv);
                }
            });
        }
        
        // Highlight search terms in text
        function highlightText(text, query) {
            if (!query.trim()) return text;
            
            const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            return text.replace(regex, '<mark class="bg-yellow-200 px-1 rounded">$1</mark>');
        }
        
        // Populate library
        function populateLibrary() {
            const container = document.getElementById('library-content');
            container.innerHTML = `
                <div class="text-center py-12">
                    <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-tools text-gray-400 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-600 mb-2">Library Coming Soon</h3>
                    <p class="text-gray-500">We're working on building an amazing knowledge library for you!</p>
                </div>
            `;
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Sidebar toggle
            sidebarToggle.addEventListener('click', toggleSidebar);
            
            // Mobile menu
            mobileMenuToggle.addEventListener('click', toggleMobileMenu);
            mobileMenuClose.addEventListener('click', toggleMobileMenu);
            
            // Navigation buttons
            document.getElementById('new-chat-btn').addEventListener('click', () => ai.newChat());
            document.getElementById('mobile-new-chat-btn').addEventListener('click', () => {
                ai.newChat();
                toggleMobileMenu();
            });
            
            document.getElementById('previous-chats-btn').addEventListener('click', () => {
                populatePreviousChats();
                showView('previous-chats-view');
            });
            document.getElementById('mobile-previous-chats-btn').addEventListener('click', () => {
                populatePreviousChats();
                showView('previous-chats-view');
                toggleMobileMenu();
            });
            
            document.getElementById('search-chat-btn').addEventListener('click', () => showView('search-view'));
            document.getElementById('mobile-search-chat-btn').addEventListener('click', () => {
                showView('search-view');
                toggleMobileMenu();
            });
            
            document.getElementById('library-btn').addEventListener('click', () => showView('library-view'));
            document.getElementById('mobile-library-btn').addEventListener('click', () => {
                showView('library-view');
                toggleMobileMenu();
            });
            
            document.getElementById('settings-btn').addEventListener('click', () => showView('settings-view'));
            document.getElementById('mobile-settings-btn').addEventListener('click', () => {
                showView('settings-view');
                toggleMobileMenu();
            });
            
            // Search functionality
            document.getElementById('search-input').addEventListener('input', handleSearch);
            
            // Settings
            document.getElementById('clear-data-btn').addEventListener('click', () => {
                if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                    localStorage.removeItem('conversations');
                    ai.conversations = [];
                    ai.currentChatId = null;
                    ai.updateRecentChats();
                    alert('All data cleared successfully!');
                }
            });
            
            // Close mobile menu when clicking outside
            mobileMenu.addEventListener('click', (e) => {
                if (e.target === mobileMenu) {
                    toggleMobileMenu();
                }
            });
            
            // Message sending
            sendBtn.addEventListener('click', sendMessage);
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // About modal
            document.getElementById('about-btn').addEventListener('click', () => {
                document.getElementById('about-modal').classList.add('show');
            });
            
            document.getElementById('mobile-about-btn').addEventListener('click', () => {
                document.getElementById('about-modal').classList.add('show');
                toggleMobileMenu();
            });
            
            document.getElementById('close-about').addEventListener('click', () => {
                document.getElementById('about-modal').classList.remove('show');
            });
            
            // Auth functionality
            document.getElementById('auth-btn').addEventListener('click', handleAuth);
            document.getElementById('mobile-auth-btn').addEventListener('click', handleAuth);
            
            // Signup modal
            document.getElementById('close-signup').addEventListener('click', () => {
                document.getElementById('signup-modal').classList.remove('show');
            });
            
            document.getElementById('signup-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('signup-name').value;
                const email = document.getElementById('signup-email').value;
                
                currentUser = { name, email };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUserInfo();
                document.getElementById('signup-modal').classList.remove('show');
                
                // Add welcome message
                addMessage(`Welcome ${name}! I'm excited to help you today. I've been trained on various topics and I'm ready to assist you.`, 'ai');
            });
            
            // Window resize
            window.addEventListener('resize', () => {
                if (window.innerWidth >= 900) {
                    const menuSlide = mobileMenu.querySelector('.mobile-menu-slide');
                    mobileMenu.classList.add('hidden');
                    menuSlide.classList.remove('open');
                    mobileMenuOpen = false;
                    document.body.style.overflow = 'auto';
                    updateSidebarState();
                } else {
                    mainContent.style.marginLeft = '0';
                }
            });
        }
        
        // Handle authentication
        function handleAuth() {
            if (currentUser) {
                // Sign out
                currentUser = null;
                localStorage.removeItem('currentUser');
                updateUserInfo();
                addMessage("You've been signed out. Thanks for using Spur AI!", 'ai');
            } else {
                // Show signup modal
                document.getElementById('signup-modal').classList.add('show');
            }
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9677710af6ec7521',t:'MTc1MzkwNTYxOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
